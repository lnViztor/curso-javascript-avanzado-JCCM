## 7.4 Observables

⚡ **¿Qué es un Observable?**
Un **Observable** es una fuente de datos que **emite valores a lo largo del tiempo**.
Puedes **suscribirte** a él para reaccionar a esos valores (como si fuera un stream de eventos).

👉 Son la base de la **programación reactiva** (usada en librerías como **RxJS** o frameworks como **Angular**).

---

### ✅ Conceptos clave

* Un **Observable** *emite* valores (next), puede *fallar* (error) o *completar* (complete).
* Un **Observer** es quien se *suscribe* para recibir esos valores.
* Un **Subscription** es el vínculo entre Observable y Observer; se puede cancelar con `.unsubscribe()`.

---

### ✏️ Ejemplo básico

```js
import { Observable } from "rxjs";

const miObservable = new Observable(subscriber => {
  subscriber.next("Hola 👋");
  subscriber.next("¿Cómo estás?");
  subscriber.complete();
});

miObservable.subscribe({
  next: valor => console.log("Valor:", valor),
  complete: () => console.log("✅ Completado")
});
```

📤 **Salida:**

```
Valor: Hola 👋
Valor: ¿Cómo estás?
✅ Completado
```

---

### 🔄 Observables vs Promesas

| Característica | Promise    | Observable              |
| -------------- | ---------- | ----------------------- |
| Emite un valor | ✅ Sí       | ⚡ Múltiples             |
| Cancelable     | ❌ No       | ✅ Sí                    |
| Ejecución      | Inmediata  | Bajo demanda            |
| Encadenable    | Sí (.then) | Sí (pipes y operadores) |

---

### 🔧 Creando observables comunes

```js
import { of, from } from "rxjs";

// Emite valores concretos
of(1, 2, 3).subscribe(console.log);

// Convierte un array a observable
from(["A", "B", "C"]).subscribe(console.log);
```

---

### ⏱️ Observables con tiempo

```js
import { interval, take } from "rxjs";

interval(1000) // emite cada segundo
  .pipe(take(3)) // solo 3 emisiones
  .subscribe(v => console.log("⏱️", v));
```

📤 **Salida:**

```
⏱️ 0
⏱️ 1
⏱️ 2
```

---

### 🧯 Manejo de errores

```js
import { throwError, catchError, of } from "rxjs";

throwError(() => new Error("Error 😱"))
  .pipe(catchError(err => of("Error capturado: " + err.message)))
  .subscribe(console.log);
```

---

### 🧩 Combinando y transformando observables

```js
import { of, map, filter } from "rxjs";

of(1, 2, 3, 4, 5)
  .pipe(
    filter(x => x % 2 === 0),
    map(x => x * 10)
  )
  .subscribe(console.log);
```

📤 **Salida:**

```
20
40
```

---

## 🛠 Laboratorio

### 🎯 Objetivos

* Crear y suscribirse a observables.
* Usar operadores básicos (`map`, `filter`, `take`).
* Manejar errores con `catchError`.
* Controlar emisiones con `interval` y `unsubscribe`.

---

### 🧪 Ejercicio 1 — Observable simple

```js
import { Observable } from "rxjs";

const saludo$ = new Observable(sub => {
  sub.next("Hola desde un Observable 👋");
  sub.complete();
});

saludo$.subscribe(console.log);
```

---

### 🧪 Ejercicio 2 — Observable con intervalo

```js
import { interval, take } from "rxjs";

const contador$ = interval(1000).pipe(take(5));
contador$.subscribe(n => console.log("Tick:", n));
```

---

### 🧪 Ejercicio 3 — Transformar valores

```js
import { of, map } from "rxjs";

of(10, 20, 30)
  .pipe(map(x => x / 10))
  .subscribe(console.log); // 1, 2, 3
```

---

### 🧪 Ejercicio 4 — Manejar errores

```js
import { throwError, catchError, of } from "rxjs";

throwError(() => new Error("Algo salió mal"))
  .pipe(catchError(e => of("Recuperado: " + e.message)))
  .subscribe(console.log);
```

---

### 🧪 Ejercicio 5 — Cancelar suscripción

```js
import { interval, takeUntil, timer } from "rxjs";

const source$ = interval(1000);
const stop$ = timer(5000); // detiene a los 5s

source$.pipe(takeUntil(stop$)).subscribe({
  next: v => console.log("Tick", v),
  complete: () => console.log("🛑 Detenido")
});
```

---

## 🚀 Retos

1. Crea un observable que emita cada 500 ms y se detenga a los 3 s.
2. Usa `from(fetch(...))` para convertir una llamada `fetch` en observable.
3. Crea una secuencia que emita nombres y solo deje pasar los que tengan más de 4 letras.
4. Combina dos observables (`of` y `interval`) con `zip` o `combineLatest`.
5. Implementa un “simulador de progreso” que emita del 0% al 100% cada 200 ms.