# 4.3 Usando finally

## üîß ¬øQu√© es finally?

`finally` es una parte opcional del bloque `try/catch` que **siempre se ejecuta**, haya error o no.
Sirve para **liberar recursos**, **cerrar conexiones**, **limpiar estados** o **mostrar mensajes finales**.

Estructura:

```js
try {
  // C√≥digo que puede fallar
} catch (error) {
  // C√≥digo cuando ocurre error
} finally {
  // Siempre se ejecuta, pase lo que pase
}
```

---

## ‚úÖ Ejemplo b√°sico

```js
try {
  console.log("Intentando ejecutar c√≥digo...");
  throw new Error("Fall√≥ algo");
} catch (error) {
  console.log("Capturado:", error.message);
} finally {
  console.log("Esto siempre se ejecuta");
}
```

Salida:

```
Intentando ejecutar c√≥digo...
Capturado: Fall√≥ algo
Esto siempre se ejecuta
```

---

## üí° Caso de uso: limpiar recursos

```js
function procesarArchivo() {
  console.log("Abriendo archivo...");
  try {
    throw new Error("No se pudo leer el archivo");
  } catch (error) {
    console.log("Error:", error.message);
  } finally {
    console.log("Cerrando archivo...");
  }
}

procesarArchivo();
```

---

## üßº Buen h√°bito: limpiar conexiones o estados

```js
let conectado = false;

try {
  conectado = true; // simular conexi√≥n
  console.log("Conectado a la base de datos");
  throw new Error("Oops");
} catch {
  console.log("Ha ocurrido un error");
} finally {
  conectado = false; // desconexi√≥n asegurada
  console.log("Conexi√≥n cerrada:", conectado);
}
```

---

# üõ† Laboratorio

## üéØ Objetivos

* Entender cu√°ndo usar finally
* Evitar fugas de estado o recursos
* Garantizar limpieza siempre

---

### Ejercicio 1 ‚Äî finally b√°sico

Completa este c√≥digo para que siempre muestre "Proceso terminado", ocurra o no error.

```js
try {
  console.log("Ejecutando operaci√≥n...");
} catch {
  console.log("Hubo un fallo");
} finally {
  console.log("Proceso terminado");
}
```

---

### Ejercicio 2 ‚Äî Simular limpieza

```js
let cargado = false;

try {
  cargado = true;
  console.log("Recurso cargado");
  throw new Error("Simulando error");
} catch (e) {
  console.log("Error:", e.message);
} finally {
  cargado = false;
  console.log("Recurso liberado:", cargado);
}
```

---

### Ejercicio 3 ‚Äî Divisi√≥n segura

Modifica la funci√≥n para que SIEMPRE muestre un mensaje final:

```js
function dividir(a, b) {
  try {
    if (b === 0) throw new Error("No se puede dividir por cero");
    console.log(a / b);
  } catch (error) {
    console.log("Error:", error.message);
  } finally {
    console.log("Fin de la operaci√≥n");
  }
}

dividir(10, 2);  // Fin de la operaci√≥n
dividir(5, 0);   // Fin de la operaci√≥n
```

---

### Ejercicio 4 ‚Äî Registro de acciones

Haz que siempre se registre la operaci√≥n aunque falle.

```js
function procesar(numero) {
  try {
    if (typeof numero !== "number") throw new TypeError("Debe ser n√∫mero");
    console.log("Procesado:", numero * 2);
  } catch (e) {
    console.log("Error:", e.message);
  } finally {
    console.log("Log: operaci√≥n con valor =", numero);
  }
}
```

---

## üöÄ Retos

1. Crea una funci√≥n `abrirSesion(usuario)` que siempre cierre la sesi√≥n en finally, aunque falle.
2. Simula abrir un archivo, leerlo y cerrarlo en finally.
3. Implementa un contador de errores que SIEMPRE aumente si hubo excepci√≥n.

